<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Registration</title>
    <style>
        .error {
            color: red;
        }
    </style>
</head>
<body>
<h1>Registration</h1>
<form id="registrationForm" method="post" th:action="@{/api/registration}" enctype="application/json">
    <label for="username">Username:</label>
    <input type="text" id="username" name="username" required>
    <span id="usernameError" class="error"></span>
    <br>

    <label for="email">Email:</label>
    <input type="email" id="email" name="email" required>
    <span id="emailError" class="error"></span>
    <br>

    <label for="phoneNumber">Phone Number:</label>
    <input type="text" id="phoneNumber" name="phoneNumber" required>
    <span id="phoneNumberError" class="error"></span>
    <br>

    <label for="password">Password:</label>
    <input type="password" id="password" name="password" required>
    <span id="passwordError" class="error"></span>
    <br>

    <label for="role">Role:</label>
    <select id="role" name="role" required>
        <option value="USER">User</option>
        <option value="ADMIN">Admin</option>
    </select>
    <br>

    <button type="submit">Register</button>
</form>

<script>
    document.getElementById('registrationForm').addEventListener('submit', function (event) {
        event.preventDefault();

        document.querySelectorAll('.error').forEach(errorSpan => errorSpan.textContent = '');

        const formData = new FormData(event.target);
        const data = Object.fromEntries(formData.entries());

        fetch('/api/registration', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(data)
        })
            .then(response => {
                if (!response.ok) {
                    return response.json().then(errorData => {
                        throw errorData;
                    });
                }
                return response.json();
            })
            .then(data => {
                window.location.href = '/';
            })
            .catch(errors => {
                Object.keys(errors).forEach(key => {
                    const errorSpan = document.getElementById(key + 'Error');
                    if (errorSpan) {
                        errorSpan.textContent = errors[key];
                    }
                });
            });
    });
</script>
</body>
</html>
